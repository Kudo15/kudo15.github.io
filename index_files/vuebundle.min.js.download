"use strict";function debounce(a,n){var r=null;return function(){clearTimeout(r);var t=arguments,e=this;r=setTimeout(function(){a.apply(e,t)},n)}}function bsTooltip(t,e){var a;if(e.modifiers.focus||e.modifiers.hover||e.modifiers.click){var n=[];e.modifiers.focus&&n.push("focus"),e.modifiers.hover&&n.push("hover"),e.modifiers.click&&n.push("click"),a=n.join(" ")}$(t).tooltip({title:e.value,placement:e.arg,trigger:a,html:e.modifiers.html})}Vue.component("datepickervue",{template:'<input v-model="thisDate">',props:["value"],data:function(){return{thisDate:this.value}},watch:{value:function(t){this.thisDate=t}},mounted:function(){var e=this;$(this.$el).datepicker({onClose:function(t){e.$emit("input",t)},changeMonth:!0,changeYear:!0,minDate:new Date(2015,0,1),maxDate:"0",defaultDate:"-0d",firstDay:1,dateFormat:"yy-mm-dd"})}}),Vue.directive("debounce",{bind:function(e,t){t.value!==t.oldValue&&(e.oninput=debounce(function(t){e.dispatchEvent(new Event("change"))},parseInt(t.value)||500))}}),Vue.component("min-revenue-filter",{props:["action","placeholder","defaultValue"],template:'<div class="form-group form-group-sm">\n                    <div class="controls">\n                        <div class="input-group">\n                            <input id="minFilter" type="text" class="form-control" :placeholder="placeholder" v-model="value" v-on:input="$emit(\'input\', $event.target.value)" v-on:keydown.enter.prevent="action" />\n                            <label for="minFilter" class="input-group-addon btn" @click.prevent="action"><i class="fa fa-usd"></i></label>\n                        </div>\n                    </div>\n                </div>',data:function(){return{value:this.defaultValue}}}),Vue.directive("only-positive-number",{bind:function(t,e){t.oninput=function(){(isNaN(t.value)||Number(t.value)<0)&&(t.value="")}}}),Vue.component("pagination",{props:["options","value","pageSize","dataLength","currentPage"],template:'\n\t\t<div class="form-inline text-right" v-show="nearPages.length > 1">\n\t\t<div class="form-group-sm form-pagination">\n\t\t\t\t<label class="control-label">Page: </label>\n\t\t\t\t<div class="btn-group btn-group-sm form-group">\n\t\t\t\t\t<label class="btn btn-default" @click="iPagePrev" :class="{ disabled: currentPageComputed === 1}"><i class="fa fa-angle-left"></i></label>\n\t\t\t\t\t<label v-for="pageNum in nearPages" class="btn btn-default" v-bind:class="{ active: pageNum == localCurrentPage }">\n\t\t\t\t\t\t<input v-if="pageNum != \'...\'" style="display: none" type="radio" name="loadItems" v-bind:value="pageNum" v-model="localCurrentPage" />\n\t\t\t\t\t{{ pageNum == \'...\' ? pageNum: pageNum +1 }}\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class="btn btn-default" @click="iPageNext" :class="{ disabled: currentPageComputed === pageCount }"><i class="fa fa-angle-right"></i></label>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<input type="text" value="" v-model="pageToGo" class="form-control" style="width: 38px; height: 28px" v-on:keypress.enter.prevent>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<button class="btn btn-default btn-sm" type="button" @click="iGoToPage">Go</button>\n\t\t\t\t</div>\n\t\t</div>\n\t\t</div>',data:function(){return{pageToGo:""}},methods:{iCheckPageIndex:function(t,e){return t<=e?0:e+1},iPagePrev:function(){var t=this;if(0===t.localCurrentPage)return!1;t.localCurrentPage=t.localCurrentPage-1},iPageNext:function(){var t=this,e=t.pageCount;if(t.localCurrentPage===e-1)return!1;t.localCurrentPage=t.localCurrentPage+1},iGoToPage:function(){var t=this,e=t.pageCount,a=t.currentPageComputed,n=parseInt(t.pageToGo);n&&n!==a&&0<n&&n<=e&&(t.localCurrentPage=n-1,t.pageToGo="")}},computed:{localCurrentPage:{get:function(){return this.currentPage},set:function(t){this.$emit("pagechanged",t)}},pageCount:function(){return Math.ceil(this.dataLength/this.pageSize)},nearPages:function(){var t=[],e=this.localCurrentPage;return 1<e&&(t.push(0),3<e&&t.push("...")),2<e&&t.push(e-2),0<e&&t.push(e-1),t.push(e),e<this.pageCount-1&&(t.push(e+1),e<this.pageCount-2&&(e<this.pageCount-3&&t.push(e+2),this.pageCount-1>e+3&&t.push("..."),t.push(this.pageCount-1))),t},currentPageComputed:{get:function(){return this.iCheckPageIndex(this.pageCount,this.localCurrentPage)}}}}),Vue.component("radio-button-group",{props:["options","defaultValue","name","buttonSize"],template:'<div class="btn-group pull-right" v-bind:class="localButtonSize">\n                    <template v-for="option in options">\n                        <label class="btn btn-default" v-bind:class="{ active: selectedValue == option.id }">\n                            <input style="display: none" type="radio" v-bind:name="name" v-bind:value="option.id" v-model="selectedValue" /> {{ option.name }}\n                        </label>\n                    </template>\n                </div>',data:function(){return{selectedValue:this.defaultValue}},watch:{selectedValue:function(t){this.$emit("input",t)}},computed:{localButtonSize:function(){return"sm"==this.buttonSize?"btn-group-sm":"btn-group-xs"}}}),Vue.component("select2",{props:["options","value"],template:"<select>\n\t\t\t\t    <slot></slot>\n\t\t\t\t</select>",mounted:function(){var t=this;$(this.$el).select2({theme:"my",data:t.options.map(t.mapData)}).val(this.value).trigger("change").on("change",function(){t.$emit("input",this.value)})},methods:{mapData:function(t){return t.text=t.name,t},findSelected:function(t,e){for(var a=0;a<t.length;a++)if(t[a].id==e)return t[a];return t[0]}},watch:{value:function(t){$(this.$el).val(t).trigger("change")},options:function(t){var e=this.findSelected(t,this.value);$(this.$el).empty().select2({theme:"my",data:t.map(this.mapData)}).val(e.id).trigger("change")}},destroyed:function(){$(this.$el).off().select2("destroy")}}),Vue.component("select-tracker",{props:["options","value","user"],template:'<select id="Tracker" class="form-control"></select>',mounted:function(){var e=this;$("#Tracker").select2({theme:"my",data:[{id:0,text:"(All Trackers)"}],minimumInputLength:2,ajax:{url:"data.svc/visits/refData/trkr",dataType:"json",data:function(t){return{name:e.user.name,trackerFilter:t.term}},processResults:function(t){var e=$.map(t.trkr,function(t){return t.text=t.name,t});return e.unshift({id:0,text:"(All Trackers)"}),{results:e}}}}).val(this.value).trigger("change").on("change",function(){e.$emit("input",this.value)})},watch:{value:function(t){$(this.$el).val(t).trigger("change")},options:function(t){$(this.$el).empty().select2({data:t})}},destroyed:function(){$(this.$el).off().select2("destroy")}}),Vue.component("select2vue",{props:["options","value","concatIdName","defaultItem","searchById","minInput"],template:"#select2-template",mounted:function(){var t=this;$(this.$el).select2({theme:"my",data:this.iMapDataToSearchIn(this.options),minimumInputLength:this.minInput,matcher:this.matchCustom}).val(this.value).trigger("change").on("change",function(){t.$emit("input",this.value)})},methods:{iMapDataToSearchIn:function(t){var e=this,a=$.map(t,function(t){return t.text=e.concatIdName?"["+t.id+"] "+t.name:t.name,t});return e.defaultItem&&(a=new Array({id:0,text:e.defaultItem}).concat(a)),a},iShouldIncludeOption:function(t,e){return this.searchById&&1===e.length?$.isNumeric(e)&&t.id==e:-1<t.text.toLowerCase().indexOf(e.toLowerCase())||this.searchById&&t.id==e},matchCustom:function(t,e){return void 0===e.text||void 0===e.id?null:this.iShouldIncludeOption(e,t.term)?e:null}},watch:{value:function(t){$(this.$el).val(t).trigger("change")},options:function(t){$(this.$el).empty().select2({data:t})}},destroyed:function(){$(this.$el).off().select2("destroy")}}),Vue.component("select-geo",{props:["options","value"],template:'<div class="form-group form-group-sm" v-show="options.length">\n                    <select style="width: 90px" id="selCountry" class="form-control js-select2-geo">\n                        <option v-for="option in options" :value="option.id">{{ option.name }}</option>\n                    </select>\n                </div>',mounted:function(){var t=this;$("#selCountry").select2({theme:"my",templateResult:t.formatCountry,templateSelection:t.formatCountry}).val(this.value).trigger("change").on("change",function(){t.$emit("input",this.value)})},methods:{formatCountry:function(t){return t.id=t.text,"(All GEO)"===t.text?t.text:$('<span><i class="flag-icon flag-icon-'+t.text.toLowerCase()+'"></i> '+t.text+"</span>")}},watch:{value:function(t){$("#selCountry").val(t).trigger("change")}},destroyed:function(){$("#selCountry").off().select2("destroy")}}),Vue.component("select-offer",{props:["value","offertype","vertical","offerid","active"],template:'<div class="form-group form-group-sm">\n                    <select id="selOffer" class="form-control"></select>\n               </div>',data:function(){return{defaultResults:[{id:"-1",text:"(All Offers)"}]}},mounted:function(){var e=this;null!==e.offerid&&void 0!==e.offerid&&$.isNumeric(e.offerid)?e.requestData({results:e.defaultResults},{term:"",offerid:e.offerid},function(t){e.createSelectOffer(t.results,1<t.results.length?t.results[1].id:e.value)}):e.createSelectOffer(e.defaultResults,e.value)},watch:{value:function(t){$(this.$el).val(t).trigger("change")},options:function(t){$(this.$el).empty().select2({data:t})}},destroyed:function(){$(this.$el).off().select2("destroy")},methods:{createSelectOffer:function(t,e){var a=this;$("#selOffer").select2({theme:"my",dataAdapter:a.createCustomDataAdapter(),minimumInputLength:2,data:t,defaultOption:a.defaultResults[0]}).on("change",function(){a.$emit("input",this.value)}).val(e).trigger("change")},prepareRequestParams:function(t){var e=this.offertype,a=this.vertical,n=this.active;return{s:t.term,ot:e,vert:a,off:t.offerid,active:n}},requestData:function(a,t,n){return $.ajax({type:"GET",url:"data.svc/searchoffers",dataType:"json",data:this.prepareRequestParams(t),success:function(t){var e=$.map(t,function(t){return t.id=t.id.toString(),t.text=t.name,t});a.results=a.results.concat(e),n(a)}})},customAdapterConstructor:function(t,e){var n=this,r=null;function a(t,e){r=e.options.defaultOption,a.__super__.constructor.call(this,t,e)}e.Extend(a,t);var i=null;return a.prototype.query=function(t,e){var a={results:[r]};t.term&&2<=t.term.length?(i&&4!=i.readyState&&i.abort(),i=n.requestData(a,t,e)):e(a)},a},createCustomDataAdapter:function(){return $.fn.select2.amd.define("select2/data/customAdapter",["select2/data/array","select2/utils"],this.customAdapterConstructor),$.fn.select2.amd.require("select2/data/customAdapter")}}}),Vue.component("select-offer-multiple",{props:["value","offertype","vertical","offerid","active","filter","id","selectedOffers"],template:'<div class="form-group form-group-sm">\n                    <select v-bind:id="elementId" class="form-control"></select>\n               </div>',data:function(){return{elementId:this.elementId}},created:function(){this.id?this.elementId=this.id:this.elementId="selOffer"},mounted:function(){var t=this;t.selectedOffers?(t.selectedOffers.forEach(function(t){t.text=t.name}),t.createSelectOffer(t.selectedOffers,t.selectedOffers.map(function(t){return t.id+""}))):t.createSelectOffer(null,t.value)},watch:{value:function(t){$("#"+this.elementId).val(t).trigger("change")},options:function(t){$("#"+this.elementId).empty().select2({data:t})}},destroyed:function(){$("#"+this.elementId).off().select2("destroy")},methods:{createSelectOffer:function(t,e){var a=this;$("#"+a.elementId).select2({theme:"my",dataAdapter:a.createCustomDataAdapter(),minimumInputLength:2,data:t,existOffer:a.filter,width:"250px",multiple:!0}).on("select2:select select2:unselect",function(t){a.$emit("input",$(this).val())}).val(e).trigger("change")},prepareRequestParams:function(t){var e=this.offertype,a=this.vertical,n=this.active;return{s:t.term,ot:e,vert:a,off:t.offerid,active:n}},requestData:function(a,t,n,r){return $.ajax({type:"GET",url:"data.svc/searchoffers",dataType:"json",data:this.prepareRequestParams(t),success:function(t){var e=$.map(t,function(t){return t.id=t.id.toString(),t.text=t.name,t});a.results=r?e.filter(function(t){return-1==r.indexOf(Number(t.id))}):e,n(a)}})},customAdapterConstructor:function(t,e){var n=this,r=null;function a(t,e){r=e.options.existOffer,a.__super__.constructor.call(this,t,e)}e.Extend(a,t);var i=null;return a.prototype.query=function(t,e){var a={results:[]};t.term&&2<=t.term.length?(i&&4!=i.readyState&&i.abort(),i=n.requestData(a,t,e,r)):e(a)},a},createCustomDataAdapter:function(){return $.fn.select2.amd.define("select2/data/customAdapter",["select2/data/array","select2/utils"],this.customAdapterConstructor),$.fn.select2.amd.require("select2/data/customAdapter")}}}),Vue.directive("tooltip",{bind:bsTooltip,update:bsTooltip,unbind:function(t,e){$(t).tooltip("destroy")}});var ReportMixin={data:function(){return{dateRanges:[{name:"Today",action:"tdy"},{name:"Yesterday",action:"ytd"},{name:"Last 3 days",action:"d3"},{name:"Last 7 days",action:"d7"},{name:"Last 14 days",action:"d14"},{name:"This month",action:"m_this"},{name:"Last month",action:"m_last"},{name:"Last 6 months",action:"m6_last"},{name:"This year",action:"y_this"},{name:"Last year",action:"y_last"}],aTimeRanges:[{name:"Last hour",isTime:1,action:"h1"},{name:"Last 2 hours",isTime:1,action:"h2"},{name:"Last 3 hours",isTime:1,action:"h3"},{name:"Last 6 hours",isTime:1,action:"h6"},{name:"Last 12 hours",isTime:1,action:"h12"}],datePickerOptions:{changeMonth:!0,changeYear:!0,minDate:new Date(2015,0,1),maxDate:this.iGetUtcDate(),defaultDate:"-0d",firstDay:1,dateFormat:"yy-mm-dd"},selectedDateRange:{},startDate:null,endDate:null,iMoment:!1,decimalDigitsInEpc:4,data:[],sortingField:"",sortingOrder:"",queryCounter:0,isLoading:!1,searchFields:[],searchString:"",searchDelay:500,searchResult:"",refDataFetchedCacheKey:"refDataFetched",skipCache:!1,reportOptions:{},currentPage:0,pageSize:100,paginationEnable:!1,refDataFetchedDates:null,selectedDevice:null,selectedCountry:0,allCarriers:[]}},methods:{setOptionStyling:function(t){return t.label=t.styledName=0<t.parent?" • "+t.name:t.name,t},setDateRanges:function(t){var e=this;switch(t.action){case"tdy":var a=e.iGetUtcDate();e.endDate=e.iFormatDate(a),e.startDate=e.iFormatDate(a);break;case"ytd":(a=e.iGetUtcDate()).setDate(a.getDate()-1),e.endDate=e.iFormatDate(a),e.startDate=e.iFormatDate(a);break;case"d3":var n=e.iGetUtcDate();(r=new Date(n)).setDate(r.getDate()-2),e.endDate=e.iFormatDate(n),e.startDate=e.iFormatDate(r);break;case"d7":n=e.iGetUtcDate();(r=new Date(n)).setDate(r.getDate()-6),e.endDate=e.iFormatDate(n),e.startDate=e.iFormatDate(r);break;case"d14":(n=e.iGetUtcDate()).setDate(n.getDate()),(r=new Date(n)).setDate(r.getDate()-13),e.endDate=e.iFormatDate(n),e.startDate=e.iFormatDate(r);break;case"m_this":n=e.iGetUtcDate();var r=new Date(n.getFullYear(),n.getMonth(),1);e.endDate=e.iFormatDate(n),e.startDate=e.iFormatDate(r);break;case"m_last":n=e.iGetUtcDate();n=new Date(n.getFullYear(),n.getMonth(),0);r=new Date(n.getFullYear(),n.getMonth(),1);e.endDate=e.iFormatDate(n),e.startDate=e.iFormatDate(r);break;case"m6_last":n=e.iGetUtcDate();n=new Date(n.getFullYear(),n.getMonth(),0);r=new Date(n.getFullYear(),n.getMonth()-5,1);e.endDate=e.iFormatDate(n),e.startDate=e.iFormatDate(r);break;case"y_this":n=e.iGetUtcDate(),r=new Date(n.getFullYear(),0,1);e.endDate=e.iFormatDate(n),e.startDate=e.iFormatDate(r);break;case"y_last":n=e.iGetUtcDate();n=new Date(n.getFullYear(),0,0);r=new Date(n.getFullYear(),0,1);e.endDate=e.iFormatDate(n),e.startDate=e.iFormatDate(r);break;case"h1":this.iSetRangeFromHourDifference(1);break;case"h2":this.iSetRangeFromHourDifference(2);break;case"h3":this.iSetRangeFromHourDifference(3);break;case"h6":this.iSetRangeFromHourDifference(6);break;case"h12":this.iSetRangeFromHourDifference(12)}},iGetUtcDate:function(){var t=new Date;return new Date(t.getTime()+6e4*t.getTimezoneOffset())},iGetOption:function(t){return this.reportOptions?this.reportOptions[t]:null},iFormatDate:function(t){return $.datepicker.formatDate("yy-mm-dd",t)},iSetRangeFromHourDifference:function(t){var e=moment().add(2,"m"),a=moment().subtract(t,"h");this.startDate=a.unix(),this.endDate=e.unix()},iAddHourTimeRanges:function(){this.dateRanges=this.aTimeRanges.concat(this.dateRanges)},iSetupDateRange:function(){this.iMoment&&this.iAddHourTimeRanges(),this.iRestoreDefaultDateRange()},iRestoreDefaultDateRange:function(){var t=this.iGetOption("defaultRangeIndex");null==t&&(t=this.iMoment?this.aTimeRanges.length:0),this.selectedDateRange=this.dateRanges[t],this.dateRangeChanged()},iRemoveStorage:function(t,e){t.removeItem(e),t.removeItem(e+"_expires")},iGetStorage:function(t,e){var a=Date.now(),n=t.getItem(e+"_expires");return null==n&&(n=0),n<a?(this.iRemoveStorage(t,e),null):t.getItem(e)},iSetStorage:function(t,e,a,n){n=null==n?3600:Math.abs(n);var r=Date.now()+1e3*n;t.setItem(e,a),t.setItem(e+"_expires",r)},dirName:function(){return window.location.pathname.split("/")[1]},cacheDateRanges:function(t){var e=this,a=function(t,e,a){var n=t+"_";return e&&(n+=e+"_"),n+a},n=e.dirName(),r=e.iGetOption("cacheSuffix"),i=a("R_startDate",r,n),s=a("R_endDate",r,n),o=a("R_selectedDateRange",r,n),u=window.sessionStorage;if(e.iGetStorage(u,i)&&e.iGetStorage(u,s)&&e.iGetStorage(u,o)&&!t){var c=e.dateRanges.filter(function(t){return t.name===e.iGetStorage(u,o)});0<c.length?(e.selectedDateRange=c[0],e.startDate=e.iGetStorage(u,i),e.endDate=e.iGetStorage(u,s)):e.iRestoreDefaultDateRange()}else e.iSetStorage(u,o,e.selectedDateRange.name,1800),e.iSetStorage(u,i,e.startDate,1800),e.iSetStorage(u,s,e.endDate,1800)},sortBy:function(t){var e=t!=this.sortingField||"asc"==this.sortingOrder;this.sortingField=t,this.sortingOrder=e?"desc":"asc"},classFor:function(t){return t!=this.sortingField?"fa":"fa fa-sort-amount-"+this.sortingOrder},highlightSort:function(t){return t!=this.sortingField?"":"info"},search:function(){var t=this;t.searchString!==t.searchResult&&setTimeout(function(){t.searchResult=t.searchString},110)},sumByField:function(t){var e=this.sortedData;return this.sumArrayByField(e,t)},sumArrayByField:function(t,e){if(!t||0==t.length)return 0;for(var a=0,n=0;n<t.length;n++)a+=t[n][e];return a},averageByField:function(t,e){var a=this.visibleData;if(!a||0==a.length)return 0;for(var n=0,r=0;r<a.length;r++)n+=a[r][t];var i=n/a.length;return e?i.toFixed(e):i},iComputeCtr:function(t,e){return 0==t||0==e?0:t/e*100},iComputeEpc:function(t,e){return 0==t?0:t/e},iComputeCr:function(t,e){return 0==e||0==t?0:t/e*100},iFormatCr:function(t){return t.toFixed(2)+"%"},iFormatRatio:function(t,e){return 0==e?"0:1":0==t?"∞:1":"1:"+Math.ceil(e/t).toString()},iFormatCtr:function(t){return t.toFixed(2)+"%"},iFormatEpc:function(t){return isFinite(t)?t.toFixed(this.decimalDigitsInEpc):"∞"},iComputeRate:function(t,e){return 0==t||0==e?0:t/e},formatAmount:function(t){return"$"+t.toFixed(2)},addComputedFields:function(t){return t.cr=this.iComputeCr(t.sales,t.clicks),t.crFormatted=this.iFormatCr(t.cr),t.ratio=t.sales/t.clicks,t.ratioFormatted=this.iFormatRatio(t.sales,t.clicks),t.ctr=this.iComputeCtr(t.clicks,t.uniques),t.ctrFormatted=this.iFormatCtr(t.ctr),void 0!==t.amount&&null!==t.amount&&(t.epc1=this.iComputeEpc(t.amount,t.uniques),t.epc1Formatted=this.iFormatEpc(t.epc1),t.epc2=this.iComputeEpc(t.amount,t.clicks),t.epc2Formatted=this.iFormatEpc(t.epc2),t.amountFormatted=this.formatAmount(t.amount),t.ap=0===t.sales?0:t.amount/t.sales,t.apFormatted=this.formatAmount(t.ap),t.epm=1e3*t.epc1,t.epmFormatted=this.iFormatEpc(t.epm)),void 0!==t.registrationscount&&null!==t.registrationscount&&(t.registrationsFormatted=t.registrationscount<0?"N/A":t.registrationscount),t},addFormattedUserName:function(t){return t.label="["+t.id+"] "+t.name,t},updateDateRangesIfNecessary:function(){var t=this.selectedDateRange;t&&t.isTime&&this.setDateRanges(t)},enqueueJsonDataFetch:function(t,e,a,n,r,i,s){var o=this,u=++o.queryCounter;o.isLoading=!0,t(e,a,function(t){o.queryCounter==u&&(n(t),o.sortingField||(o.sortingField=r||"amount",o.sortingOrder=i||"desc"))}).complete(function(t){o.queryCounter==u&&(o.isLoading=!1,s||o.cacheDateRanges(1))})},concatRefData:function(t,e,a){return[{id:a||null,name:e}].concat(t)},refData:function(a,t,e,n){for(var r=this,i={},s="",o="",u=e.lastIndexOf("/")+1,c=e.substring(u).split("_"),l=r.dirName(),d=0;d<c.length;++d){var h=c[d],f=a.getItem("ReportVM_"+l+"_"+h);f?i[h]=JSON.parse(f):(s=s+o+h,o="_")}0<s.length?t(e.substring(0,u)+s,function(t){for(var e in t)i[e]=t[e],r.trySaveToCache("ReportVM_"+l+"_"+e,JSON.stringify(i[e]),a);n(i)}):n(i)},getNullableID:function(t){return t?t.id:null},getID:function(t){return this.getNullableID(t)||0},queryStringParam:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},tryGetOldestRefData:function(){var t,e=Number.MAX_VALUE,a=this.refDataFetchedDates;for(var n in a){var r=a[n];r<e&&(e=r,t=n)}return t},saveToCache:function(t,e,a){var n=this.refDataFetchedDates,r=n;try{r[t]=(new Date).getTime(),a.setItem(this.refDataFetchedCacheKey,JSON.stringify(r))}catch(t){return!1}try{a.setItem(t,e)}catch(t){return a.setItem(this.refDataFetchedCacheKey,JSON.stringify(n)),!1}return!0},trySaveToCache:function(t,e,a){if(!this.saveToCache(t,e,a)){var n=!0;do{var r=this.tryGetOldestRefData();r?(a.removeItem(r),delete this.refDataFetchedDates[r],this.saveToCache(t,e,a)&&(n=!1)):n=!1}while(n)}},skimDefaultValueFromId:function(t,e){return t!==e?t:void 0},determineIfMobileOperator:function(t){return 2==t||3==t},sortDataAccordingToCurrentSettings:function(t){var e=t;if(!e||e.length<2)return e;var a=this.sortingField,n="desc"==this.sortingOrder,r=e[0][a];if("number"==typeof r){var i=n?function(t,e){return isNaN(t[a])?1:isNaN(e[a])?-1:e[a]-t[a]}:function(t,e){return isNaN(e[a])?1:isNaN(t[a])?-1:t[a]-e[a]};return e.slice().sort(i)}if("string"==typeof r){i=n?function(t,e){return e.key<t.key?-1:e.key>t.key?1:0}:function(t,e){return e.key>t.key?-1:e.key<t.key?1:0};return e.map(function(t){return{key:t[a].toLowerCase(),value:t}}).sort(i).map(function(t){return t.value})}return e},dateRangeChanged:function(){this.setDateRanges(this.selectedDateRange)},useDatesFromQueryString:function(){var t=this,e=t.queryStringParam("startDate"),a=t.queryStringParam("endDate");if(e&&a)try{$.datepicker.parseDate("yy-mm-dd",e),$.datepicker.parseDate("yy-mm-dd",a),t.skipCache=!0,t.startDate=e,t.endDate=a}catch(t){}}},computed:{hasReportData:function(){return!!this.data},visibleData:function(){var t=this.searchResult,e=this.searchFields;-1===e.indexOf("id")&&e.push("id");var a=this.data;if(!t||!a||0===a.length)return a;for(var n=a[0],r=$.isNumeric(t),i=[],s=[],o=0;o<e.length;++o){(d=e[o])in n&&(r&&"number"==typeof n[d]?i.push(d):"string"==typeof n[d]&&s.push(d))}if(0===i.length&&0===s.length)return[];var u=null,c=null;if(0!==s.length){var l=new RegExp(t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");if(1===s.length){var d=s[0];c=function(t){return l.test(t[d])}}else c=function(t){for(var e=0;e<s.length;++e){var a=s[e];if(l.test(t[a]))return!0}return!1}}if(0!==i.length){var h=new Number(t);if(1===i.length){d=i[0];u=function(t){return t[d]===h}}else u=function(t){for(var e=0;e<i.length;++e){if(t[i[e]]===h)return!0}return!1}}var f=null;return f=u&&c?function(t){return u(t)||c(t)}:u||c,this.currentPage=0,a.filter(f)},sortedData:function(){var t=this.sortDataAccordingToCurrentSettings(this.visibleData);return this.paginationEnable?t.slice(this.currentPage*this.pageSize,(this.currentPage+1)*this.pageSize):t},classForName:function(){return this.classFor("name")},classForVisits:function(){return this.classFor("visits")},classForUniques:function(){return this.classFor("uniques")},classForClicks:function(){return this.classFor("clicks")},classForSales:function(){return this.classFor("sales")},classForRatio:function(){return this.classFor("ratio")},classForCr:function(){return this.classFor("cr")},classForCtr:function(){return this.classFor("ctr")},classForEpc1:function(){return this.classFor("epc1")},classForEpc2:function(){return this.classFor("epc2")},classForEPM:function(){return this.classFor("epm")},classForAmount:function(){return this.classFor("amount")},classForAp:function(){return this.classFor("ap")},classForUserID:function(){return this.classFor("userID")},classForUserName:function(){return this.classFor("userName")},classForConversions:function(){return this.classFor("conversions")},classForRevenue:function(){return this.classFor("revenue")},classForSalesRevenue:function(){return this.classFor("salesRevenue")},classForQR:function(){return this.classFor("qr")},classForRate:function(){return this.classFor("rate")},classForCost:function(){return this.classFor("cost")},classForProfit:function(){return this.classFor("profit")},isDateRangeVisible:function(){return!this.selectedDateRange.isTime},visitsTotal:function(){return this.sumByField("visits")},uniquesTotal:function(){return this.sumByField("uniques")},clicksTotal:function(){return this.sumByField("clicks")},salesTotal:function(){return this.sumByField("sales")},crTotal:function(){return this.iComputeCr(this.salesTotal,this.clicksTotal)},crTotalFormatted:function(){return this.iFormatCr(this.crTotal)},ratioTotalFormatted:function(){return this.iFormatRatio(this.salesTotal,this.clicksTotal)},apTotal:function(){return this.averageByField("ap")},apTotalFormatted:function(){return this.formatAmount(this.apTotal)},amountTotal:function(){return this.sumByField("amount")},amountTotalFormatted:function(){return this.formatAmount(this.amountTotal)},ctrTotal:function(){return this.iComputeCtr(this.clicksTotal,this.uniquesTotal)},ctrTotalFormatted:function(){return this.iFormatCtr(this.ctrTotal)},epc1Total:function(){return this.iComputeEpc(this.amountTotal,this.uniquesTotal)},epc1TotalFormatted:function(){return this.iFormatEpc(this.epc1Total)},epc2Total:function(){return this.iComputeEpc(this.amountTotal,this.clicksTotal)},epc2TotalFormatted:function(){return this.iFormatEpc(this.epc2Total)},epmTotal:function(){return 1e3*this.epc1Total},epmTotalFormatted:function(){return this.iFormatEpc(this.epmTotal)},isShowingOperators:function(){var t=this.selectedDevice;return t&&this.determineIfMobileOperator(t.id)},availableCarriers:function(){var e=Number(this.selectedCountry),t=this.allCarriers;return e&&t?t.filter(function(t){return-1==t.id||t.v?1:t.cnt?0<=t.cnt.indexOf(e):0}):t}},created:function(){this.iSetupDateRange(),this.cacheDateRanges();var t=JSON.parse(sessionStorage.getItem(this.refDataFetchedCacheKey));this.refDataFetchedDates=t||{}}},UserReportMixin={data:function(){return{cacheKey:"LabReports_SelectedUser",paginationEnable:!0,pageSize:100,availablePageSize:[100,500,1e3,2e3],selectedUser:null,availableUsers:[],availableGroupCells:["Day","Country","Tracker"],selectedGroupCell:0,selectedVertical:0,availableVerticals:[],selectedDeviceType:0,availableDeviceTypes:[],selectedTracker:0,displayedGroupCell:"",searchFields:["name"],reportOptions:{defaultRangeIndex:3,cacheSuffix:"AffiliateReports"}}},methods:{prepareRequestParams:function(){this.updateDateRangesIfNecessary();var t=this.startDate,e=this.endDate,a=this.selectedVertical,n=this.showTrackerFilter?this.selectedTracker:void 0,r=this.getID(this.selectedDeviceType),i=this.selectedUser,s=i?i.name:null,o=this.selectedGroupCell.toLowerCase();return s&&t&&e&&a?{name:s,startDate:t,endDate:e,vert:a.id,tracker:n,dt:r,group:o}:void 0},getUsersRefDataAsync:function(){var e=new $.Deferred,a=this;return $.getJSON("data.svc/visits/refData/vert_dt",{name:a.selectedUser.name},function(t){a.availableVerticals=a.concatRefData(t.vert,"(All Verticals)"),a.availableDeviceTypes=a.concatRefData(t.dt,"(All Devices)"),a.selectedVertical=a.availableVerticals[0],a.selectedDeviceType=a.availableDeviceTypes[0],e.resolve()}),e.promise()},classForCountry:function(t){return"flag-icon flag-icon-"+t.toLowerCase()},onPageChanged:function(t){this.currentPage=t},enqueueReportDataFetch:function(t){var e="day"==t.group?"name":"amount",a="day"==t.group?"asc":"desc";this.sortingField="",this.currentPage=0;var n=this;this.enqueueJsonDataFetch($.getJSON,"data.svc/visits/get",t,function(t){n.displayedGroupCell=n.selectedGroupCell,t.days?n.data=t.days.map(function(t){return t.name=t.day,delete t.day,n.addComputedFields(t)}):t.trackers?n.data=t.trackers.map(function(t){return t.name=t.tr,delete t.tr,n.addComputedFields(t)}):n.data=t.countries.map(n.addComputedFields)},e,a)},searchUsers:function(t,e){e(!0),this.getUsers(t,e)},getUsers:function(t,e){var a=this;a.searchUsersAPI(t,function(t){a.availableUsers=t.map(a.addFormattedUserName),e(!1)})},searchUsersAPI:function(t,e){$.getJSON("data.svc/searchusers",{s:t},function(t){e(t)})}},computed:{refreshProhibited:function(){return!this.selectedUser},showTrackerFilter:function(){return"Tracker"!=this.selectedGroupCell}},watch:{selectedUser:function(t){var e=this;if(t){window.sessionStorage.setItem(this.cacheKey,JSON.stringify(t));var a=this.getUsersRefDataAsync();$.when(a).done(function(){e.enqueueDataFetch()})}else e.isLoading=!1},selectedGroupCell:function(t){"Tracker"==t?this.selectedTracker=0:(this.searchString="",this.searchResult="")}},created:function(){Vue.component("v-select",VueSelect.VueSelect)},mounted:function(){var a=this;this.selectedGroupCell=this.availableGroupCells[0],this.displayedGroupCell=this.selectedGroupCell;var t=JSON.parse(window.sessionStorage.getItem(this.cacheKey)),e=a.queryStringParam("name"),n=e||(t?t.name:null);n&&(n=n.toUpperCase()),n&&this.searchUsersAPI(n,function(t){for(var e=0;e<t.length;e++)if(t[e].name.toUpperCase()==n){a.selectedUser=a.addFormattedUserName(t[e]);break}})}};